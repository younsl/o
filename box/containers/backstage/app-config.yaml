app:
  title: Backstage
  baseUrl: http://localhost:3000
  gitlab:
    host: ${GITLAB_HOST}
  platforms:
    - name: Grafana
      category: Observability
      description: Metrics visualization and dashboards
      url: https://grafana.example.com
      logo: https://cdn.jsdelivr.net/gh/grafana/grafana@main/public/img/grafana_icon.svg
      tags: shared
    - name: ArgoCD
      category: CI/CD
      description: GitOps continuous delivery
      url: https://argocd.example.com
      logo: https://argo-cd.readthedocs.io/en/stable/assets/logo.png
      tags: shared
    - name: QueryPie (nonprd)
      category: Data
      description: Data access governance platform
      url: https://querypie-nonprd.example.com
      logo: https://backstage.io/logo_assets/svg/Icon_Teal.svg
      tags: nonprd
    - name: QueryPie (prd)
      category: Data
      description: Data access governance platform
      url: https://querypie-prd.example.com
      logo: https://backstage.io/logo_assets/svg/Icon_Teal.svg
      tags: prd

organization:
  name: DevOps Portal

backend:
  baseUrl: http://localhost:7007
  listen:
    port: 7007
  auditor:
    severityLogLevelMappings:
      low: debug
      medium: info
      high: info
      critical: error
  csp:
    connect-src: ["'self'", 'http:', 'https:']
  cors:
    origin: http://localhost:3000
    methods: [GET, HEAD, PATCH, POST, PUT, DELETE]
    credentials: true
  database:
    client: better-sqlite3
    connection: ':memory:'
  auth:
    dangerouslyDisableDefaultAuthPolicy: true
  reading:
    allow:
      - host: localhost:7007

integrations:
  gitlab:
    - host: ${GITLAB_HOST}
      token: ${GITLAB_TOKEN}
      apiBaseUrl: https://${GITLAB_HOST}/api/v4

catalog:
  import:
    entityFilename: catalog-info.yaml
    pullRequestBranchName: backstage-integration
  rules:
    - allow: [Component, System, API, Resource, Location, Domain, Group, User, Template]
  providers:
    gitlab:
      yourProviderId:
        host: ${GITLAB_HOST}
        branch: main
        fallbackBranch: master
        skipForkedRepos: false
        entityFilename: catalog-info.yaml
        schedule:
          frequency: { minutes: 1 }
          timeout: { minutes: 3 }
          initialDelay: { seconds: 10 }
    gitlabOrg:
      yourOrgProviderId:
        host: ${GITLAB_HOST}
        schedule:
          frequency: { hours: 1 }
          timeout: { minutes: 5 }
          initialDelay: { seconds: 30 }
  locations:
    - type: file
      target: ../../templates/register-component/template.yaml
      rules:
        - allow: [Template]

auth:
  environment: development
  session:
    secret: ${AUTH_SESSION_SECRET}
  providers:
    guest:
      dangerouslyAllowOutsideDevelopment: true
    oidc:
      development:
        clientId: ${KEYCLOAK_CLIENT_ID}
        clientSecret: ${KEYCLOAK_CLIENT_SECRET}
        metadataUrl: ${KEYCLOAK_METADATA_URL}
        prompt: auto
        signIn:
          resolvers:
            - resolver: emailLocalPartMatchingUserEntityName
              dangerouslyAllowSignInWithoutUserInCatalog: true

scaffolder:
  defaultScmIntegrations: true

techdocs:
  builder: 'local'
  generator:
    runIn: 'local'
  publisher:
    type: 'local'

gitlab:
  defaultCodeOwnersPath: CODEOWNERS
  defaultReadmePath: README.md
  allowedKinds:
    - Component
    - Resource

sonarqube:
  baseUrl: ${SONARQUBE_BASE_URL}
  apiKey: ${SONARQUBE_API_KEY}

argocdApplicationSet:
  enabled: true 
  kubernetes:
    # Optional: in-cluster mode uses SA token automatically
    # serviceAccountToken: ${K8S_SA_TOKEN}
    # Namespace where ApplicationSets are deployed
    namespace: argocd
  slack:
    webhookUrl: ${SLACK_WEBHOOK_URL}
  # All cron expressions are evaluated in UTC (container default timezone)
  schedule:
    # Optional: fetch interval (default: every 1 minute)
    # fetchCron: '*/5 * * * *'
    # Slack notification: weekdays 10-11, 14-18 every hour (UTC)
    cron: '0 10-11,14-18 * * 1-5'

iamUserAudit:
  enabled: true
  # Skip AWS IAM password reset API call (for local development)
  dryRun: true
  # Days of inactivity to flag a user (default: 90)
  inactiveDays: 90
  # AWS region for IAM API (IAM is global, but SDK needs a region)
  region: us-east-1
  # Optional: assume this IAM role for API calls (for local dev or cross-account)
  # In production, EKS Pod Identity provides credentials directly.
  # assumeRoleArn: arn:aws:iam::123456789012:role/backstage-iam-user-audit-role
  slack:
    webhookUrl: ${IAM_AUDIT_SLACK_WEBHOOK_URL}
    # Bot Token for sending DM to requester on approval (xoxb-...)
    # Required scopes: users:read.email, chat:write
    botToken: ${IAM_AUDIT_SLACK_BOT_TOKEN}
  # All cron expressions are evaluated in UTC (container default timezone)
  schedule:
    # How often to fetch IAM user data (default: every 5 minutes)
    fetchCron: '*/5 * * * *'
    # Slack notification schedule (default: weekdays 10 AM UTC)
    cron: '0 10 * * 1-5'

permission:
  admins:
    - user:default/admin1
    - user:default/admin2

proxy:
  endpoints: {}

search:
  collators:
    catalog:
      schedule:
        frequency: { minutes: 1 }
        timeout: { minutes: 15 }
        initialDelay: { seconds: 10 }
