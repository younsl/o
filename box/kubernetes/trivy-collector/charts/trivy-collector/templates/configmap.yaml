{{- if and (eq .Values.mode "server") (eq .Values.server.auth.mode "keycloak") }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "trivy-collector.fullname" . }}-auth
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "trivy-collector.labels" . | nindent 4 }}
data:
  AUTH_MODE: {{ .Values.server.auth.mode | quote }}
  OIDC_ISSUER_URL: {{ .Values.server.auth.sso.issuer | quote }}
  OIDC_REDIRECT_URL: {{ .Values.server.auth.sso.redirectUrl | quote }}
  OIDC_SCOPES: {{ join " " .Values.server.auth.sso.scopes | quote }}
{{- end }}
